{
  "active": true,
  "connections": {
    "OpenAI": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "getinfo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "getinfo": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-11-07T17:52:29.069Z",
  "id": "v5v9vCvAfmZhplGx",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "FB Post Generator",
  "nodes": [
    {
      "parameters": {
        "resource": "assistant",
        "assistantId": {
          "__rl": true,
          "value": "asst_H5sZCPDj3ILtC5dA6oUg9xYZ",
          "mode": "list",
          "cachedResultName": "Blaze n8n Assistant"
        },
        "prompt": "define",
        "text": "=Write a concise and engaging property description for a social media post using the following information:\n- Add warmth and practicality, avoiding excessive fluff.\n- Use emojis sparingly to make the post visually appealing.\n- Include a strong call to action.\n- Display the property link as plain text to ensure it is clickable on social media platforms.\n- Here is the property information: {{ $json.marketing_description }}. \nInclude the line: \"Schedule A Showing Here: {{ $json.property_link }}\" after the description.\n",
        "options": {}
      },
      "id": "23053978-7bfd-4ead-aae8-ab8a895f3570",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.4,
      "position": [
        100,
        200
      ],
      "credentials": {
        "openAiApi": {
          "id": "Navm9hDUnjwpRcbB",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "44a8e64e-20d4-4d18-a37e-b99634fa9fb7",
        "responseMode": "lastNode",
        "options": {
          "allowedOrigins": "https://blzres.com"
        }
      },
      "id": "865176ed-0885-4061-ada2-a78ab4b73111",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -500,
        200
      ],
      "webhookId": "63e9bc9c-5380-4d55-bd61-ff22e5c7998b"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT marketing_description, bedrooms, bathrooms, advertised_rent, application_fee, sqft, unit_address, default_deposit, appliances, property_link FROM all_rental_properties WHERE unit_name = '{{ $json.body.unit_name }}';"
      },
      "name": "getinfo",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 1,
      "position": [
        -300,
        200
      ],
      "id": "fff22388-7a34-4f4d-bccc-024ba1ddcc88",
      "credentials": {
        "mySql": {
          "id": "OUIfR0k9k0YXHa0V",
          "name": "a2 blazedata mySQL"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Access AI-generated HTML from the OpenAI node\nlet aiGeneratedHtml = $node[\"OpenAI\"].json.output || \"<p>No description available.</p>\";\n\n// Remove code block markers if they exist in the AI output\naiGeneratedHtml = aiGeneratedHtml.replace(/```html\\s*([\\s\\S]*?)\\s*```/, '$1').trim();\n\n// Access data from the Edit Fields node\nconst data = $node[\"Edit Fields\"].json || {};\n\n// Construct the final response HTML with direct field references\nconst finalOutput = `\n<div style=\"font-family: Arial, sans-serif; color: #333;\">\n  ${aiGeneratedHtml} <!-- AI-generated HTML -->\n  <br>\n  <h3 style=\"color: #2a9d8f; margin-top: 20px;\">Property Details</h3>\n  <ul style=\"list-style: none; padding: 0;\">\n    <li><strong>Rent:</strong> $${data.advertised_rent || \"N/A\"}</li>\n    <li><strong>Bedrooms:</strong> ${data.bedrooms || \"N/A\"}</li>\n    <li><strong>Bathrooms:</strong> ${data.bathrooms || \"N/A\"}</li>\n    <li><strong>Application Fee:</strong> $${data.application_fee || \"N/A\"}</li>\n    <li><strong>Square Footage:</strong> ${data.sqft ? `${data.sqft} sq ft` : \"Not specified\"}</li>\n    <li><strong>Deposit:</strong> $${data.default_deposit || \"N/A\"}</li>\n    <li><strong>Appliances:</strong> ${data.appliances || \"Not specified\"}</li>\n\n  </ul>\n  <br>\n  <p>${data.blaze_description || \"Not specified\"}</p>\n</div>\n`;\n\n// Return the structured response\nreturn {\n    json: {\n        response: finalOutput\n    }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        440,
        200
      ],
      "id": "c2607aa6-1408-4b12-87f1-aecfc99061b7",
      "name": "Code"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d6671822-a90d-4907-9c55-b837b6d303ba",
              "name": "bedrooms",
              "value": "={{ $json.bedrooms }}",
              "type": "number"
            },
            {
              "id": "611538e1-a7c3-4141-a1d9-a061294db015",
              "name": "bathrooms",
              "value": "={{ $json.bathrooms }}",
              "type": "number"
            },
            {
              "id": "7cc76e3b-76b2-40cb-9e36-d97fcc8188e3",
              "name": "advertised_rent",
              "value": "={{ $json.advertised_rent }}",
              "type": "string"
            },
            {
              "id": "15f1311e-7c97-4568-a2d2-0098731f6420",
              "name": "application_fee",
              "value": "={{ $json.application_fee }}",
              "type": "string"
            },
            {
              "id": "f64296a3-8a98-48a4-a64c-f6d0b8363bcd",
              "name": "sqft",
              "value": "={{ $json.sqft }}",
              "type": "number"
            },
            {
              "id": "ab7bed29-1efb-4c9f-808a-c35982e944a2",
              "name": "unit_address",
              "value": "={{ $json.unit_address }}",
              "type": "string"
            },
            {
              "id": "ae44028d-f5a2-4a7d-b993-d302150c9d48",
              "name": "default_deposit",
              "value": "={{ $json.default_deposit }}",
              "type": "string"
            },
            {
              "id": "2a7aa5b3-f54f-4368-b67f-5edff321b3e7",
              "name": "appliances",
              "value": "={{ $json.appliances }}",
              "type": "string"
            },
            {
              "id": "eb382d68-b58d-46d7-8914-d9c12c98de79",
              "name": "property_link",
              "value": "={{ $json.property_link }}",
              "type": "string"
            },
            {
              "id": "fe1ac564-3400-46eb-b692-9d1f10adb18f",
              "name": "marketing_description",
              "value": "={{ $json.marketing_description }}",
              "type": "string"
            },
            {
              "id": "fe49562e-1b41-451b-89fc-4985a45e253c",
              "name": "blaze_description",
              "value": "Blaze Real Estate - Your trusted partner in finding homes across the Texas Panhandle. üè† Serving with excellence in sales and property management.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -80,
        200
      ],
      "id": "c57da40d-5730-4043-8129-408da3dbde7c",
      "name": "Edit Fields"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "errorWorkflow": "Etm1h3dHXQYzby5C"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2024-12-10T13:42:09.000Z",
  "versionId": "9d7f278d-7093-40f9-b6eb-4b556a283f21"
}